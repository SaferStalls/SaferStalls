<!DOCTYPE HTML>
<html>
<head>
<script src="OpenLayers.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<title>Interactive Map</title>
</head>
<body>
<div id="demoMap" style="height:400px"></div>
<script>
    var map = new OpenLayers.Map("demoMap");
    map.addLayer(new OpenLayers.Layer.OSM());
    epsg4326 =  new OpenLayers.Projection("EPSG:4326"); 
    projectTo = map.getProjectionObject();
    var lonLat = new OpenLayers.LonLat( -122.435189 ,37.7357156666667 ).transform(epsg4326, projectTo);
    var zoom=10;
    map.setCenter (lonLat, zoom);
</script>
<script>
    //Creates overlay layer of markers
    var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
    var markers = new OpenLayers.Layer.Markers("Markers");
    map.addLayer(markers);

    var longLatsOuter = new Array();
    var outerCount = 0;
    jQuery.getJSON("safepee.json", function(json){
        jQuery.each(json,function(i,item){
            longLatsOuter[outerCount] = [json[i].lon,json[i].lat];
            outerCount++;
        });
        var size = new OpenLayers.Size(21,25);
        var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
        var icon = new OpenLayers.Icon('http://www.openlayers.org/dev/img/marker.png', size, offset);
        for (var j= 0;j<outerCount;j++){
            var lon = longLatsOuter[j][0];
            var lat = longLatsOuter[j][1];
            var feature = new OpenLayers.Feature.Vector(
                new OpenLayers.Geometry.Point(lon, lat).transform(epsg4326, projectTo),
                {description:'This is the value of<br>the description attribute'} ,
                {externalGraphic: 'marker.png', graphicHeight: 50, graphicWidth: 42, graphicXOffset:-12, graphicYOffset:-25  }
            );
            vectorLayer.addFeatures(feature);
        }   
        map.addLayer(vectorLayer);
    });
</script>
<form name="addRESS" id="form">
    <label for="address">Street Address:</label>
    <input type="text" name="Address" id="address"/>
    <label for="city">City:</label>
    <input type="text" name="City" id="city"/>
    <label for="state">State:</label>
    <input type="text" name="State" id="state"/>
    <input type="submit" value="Submit"/>
</form>
<script>
    jQuery("#form").submit(function(e){
        e.preventDefault();
        var streetAddress = document.getElementById('address').value;
        var city = document.getElementById('city').value;
        var state = document.getElementById('state').value;
        var queryString=encodeURIComponent(String(streetAddress))+","+encodeURIComponent(" "+String(city))+","+encodeURIComponent(" "+String(state));
        var jsonADD = "http://nominatim.openstreetmap.org/search/"+queryString+"?format=json&polygon=1&addressdetails=1";
        jQuery.getJSON(jsonADD, function(data){
            jQuery.each(data, function(i,item){
                epsg4326 =  new OpenLayers.Projection("EPSG:4326");
                projectTo = map.getProjectionObject();
                lonLat = new OpenLayers.LonLat(data[i].lon,data[i].lat).transform(epsg4326, projectTo);
                zoom=14;
                map.setCenter (lonLat, zoom);$
            });
        });
        
    });
</script>
</body>
